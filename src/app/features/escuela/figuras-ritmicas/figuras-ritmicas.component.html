<div class="figuras-container">
  <header class="section-header">
    <h1>â™ª Figuras RÃ­tmicas</h1>
    <p>Haz clic en cada figura para escuchar su duraciÃ³n</p>
  </header>

  <div class="figures-grid">
    <div
      *ngFor="let figure of figures"
      class="figure-card"
      [class.active]="activeFigure === figure.id"
      (click)="playFigure(figure)">
      
      <div class="figure-symbol" [style.transform]="'scale(' + getScale(figure.duration) + ')'">
        {{ figure.symbol }}
      </div>

      <h3 class="figure-name">{{ figure.name }}</h3>
      <p class="figure-description">{{ figure.description }}</p>

      <!-- Duration visualizer -->
      <div class="duration-bar">
        <div 
          class="duration-fill" 
          [class.animating]="activeFigure === figure.id"
          [style.width.%]="(figure.duration / 4) * 100">
        </div>
      </div>

      <!-- Pulse indicators -->
      <div class="pulse-indicators">
        <span 
          *ngFor="let pulse of [].constructor(Math.ceil(figure.duration)); let i = index"
          class="pulse-dot"
          [class.active]="activeFigure === figure.id && pulseAnimation">
        </span>
      </div>
    </div>
  </div>

  <div class="info-box">
    <h3>ğŸ’¡ Â¿CÃ³mo funciona?</h3>
    <p>Cada figura representa una duraciÃ³n diferente:</p>
    <ul>
      <li>MÃ¡s grande = mÃ¡s larga</li>
      <li>Los puntos muestran los pulsos</li>
      <li>La barra muestra la duraciÃ³n relativa</li>
    </ul>
  </div>

  <div class="pentagrama-demo" #pentagramaSection>
    <h2>Pentagrama en compÃ¡s 4/4</h2>
    <p>Selecciona una figura para verla dentro del compÃ¡s de 4 segundos</p>

    <div class="pentagrama-content" *ngIf="currentPattern; else pentagramaEmpty">
      <div class="pentagrama-meta">
        <span class="figure-label">{{ currentPattern.name }}</span>
        <span class="figure-detail">
          {{ noteSlots.length }} nota{{ noteSlots.length === 1 ? '' : 's' }} de {{ currentPattern.duration }}s
        </span>
      </div>

      <div class="staff">
        <div class="staff-lines">
          <span class="staff-line" *ngFor="let line of [1, 2, 3, 4, 5]"></span>
        </div>
        <span class="measure-bar left"></span>
        <span class="measure-bar right"></span>

        <div
          class="notes"
          [style.gridTemplateColumns]="'repeat(' + noteSlots.length + ', 1fr)'">
          <div
            *ngFor="let note of noteSlots; let i = index"
            class="note"
            [class.active]="noteActive[i]"
            [style.--pulse-interval]="'1s'">
            <span class="note-symbol">{{ currentPattern.symbol }}</span>
            <span class="note-time">{{ currentPattern.duration }}s</span>
          </div>
        </div>
      </div>

      <button
        class="play-button"
        (click)="playFigure(currentPattern!)"
        [disabled]="isPlayingPattern">
        {{ isPlayingPattern ? 'Reproduciendo...' : 'Repetir' }}
      </button>
    </div>

    <ng-template #pentagramaEmpty>
      <div class="pentagrama-empty">Selecciona una figura para ver el compÃ¡s.</div>
    </ng-template>
  </div>
</div>
